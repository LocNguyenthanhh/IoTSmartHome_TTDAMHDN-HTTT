<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Home - Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e3f2fd 100%);
            min-height: 100vh;
            transition: all 0.3s;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
        }

        body.dark-mode .header,
        body.dark-mode .temp-card,
        body.dark-mode .stat-card,
        body.dark-mode .feature-card,
        body.dark-mode .device-item {
            background: #1f2937;
            box-shadow: 0 1px 3px rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .temp-card {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }

        body.dark-mode .user-text h3,
        body.dark-mode .temp-location,
        body.dark-mode .temp-value h1,
        body.dark-mode .temp-status,
        body.dark-mode .temp-details div p:last-child,
        body.dark-mode .stat-card h2,
        body.dark-mode .section-header h2,
        body.dark-mode .feature-card h3,
        body.dark-mode .device-text h4 {
            color: #f3f4f6;
        }

        body.dark-mode .user-text p,
        body.dark-mode .temp-details div p:first-child,
        body.dark-mode .stat-card p,
        body.dark-mode .feature-card p,
        body.dark-mode .device-text p {
            color: #9ca3af;
        }

        body.dark-mode .see-all {
            color: #60a5fa;
        }

        body.dark-mode .stat-icon.green { background: #166534; }
        body.dark-mode .stat-icon.blue { background: #1e40af; }
        body.dark-mode .stat-icon.purple { background: #6b21a8; }

        body.dark-mode .feature-icon.blue { background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%); }
        body.dark-mode .feature-icon.green { background: linear-gradient(135deg, #166534 0%, #14532d 100%); }
        body.dark-mode .feature-icon.purple { background: linear-gradient(135deg, #6b21a8 0%, #5b21b6 100%); }
        body.dark-mode .feature-icon.orange { background: linear-gradient(135deg, #9a3412 0%, #7c2d12 100%); }

        body.dark-mode .device-icon.yellow { background: #92400e; }
        body.dark-mode .device-icon.blue { background: #1e40af; }

        body.dark-mode .toggle-switch.off {
            background: #4b5563;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            background: transparent;
        }

        /* Header */
        .header {
            background: white;
            padding: 16px 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.2s;
            padding: 4px;
            border-radius: 12px;
        }

        .user-info:hover {
            background: #f3f4f6;
        }

        body.dark-mode .user-info:hover {
            background: #374151;
        }

        .user-info:active {
            transform: scale(0.98);
        }

        .avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .user-text h3 {
            font-size: 14px;
            font-weight: 600;
            color: #1f2937;
        }

        .user-text p {
            font-size: 12px;
            color: #6b7280;
        }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        /* Auth Button */
        .auth-button {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }

        .auth-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .auth-button:active {
            transform: translateY(0);
        }

        .auth-button.logout {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        /* Main Content */
        .content {
            padding: 24px;
        }

        /* Temperature Card */
        .temp-card {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border-radius: 24px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.3);
        }

        .temp-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .temp-location {
            display: flex;
            align-items: center;
            gap: 8px;
            color: rgba(255,255,255,0.8);
            font-size: 14px;
        }

        .temp-value {
            display: flex;
            align-items: flex-end;
            gap: 8px;
            margin-bottom: 16px;
        }

        .temp-value h1 {
            font-size: 48px;
            font-weight: 700;
            color: white;
        }

        .temp-status {
            color: rgba(255,255,255,0.8);
            margin-bottom: 8px;
        }

        .temp-details {
            display: flex;
            gap: 24px;
            color: rgba(255,255,255,0.8);
            font-size: 14px;
        }

        .temp-details div p:first-child {
            opacity: 0.8;
            margin-bottom: 4px;
        }

        .temp-details div p:last-child {
            font-weight: 600;
            color: white;
        }

        /* Quick Stats */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: white;
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
        }

        .stat-icon.green { background: #dcfce7; color: #16a34a; }
        .stat-icon.blue { background: #dbeafe; color: #2563eb; }
        .stat-icon.purple { background: #f3e8ff; color: #9333ea; }

        .stat-card h2 {
            font-size: 24px;
            font-weight: 700;
            color: #1f2937;
        }

        .stat-card p {
            font-size: 12px;
            color: #6b7280;
        }

        /* Features */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .section-header h2 {
            font-size: 18px;
            font-weight: 700;
            color: #1f2937;
        }

        .see-all {
            color: #3b82f6;
            font-size: 14px;
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .feature-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            text-decoration: none;
            color: inherit;
            display: block;
        }

        .feature-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }

        .feature-card:active {
            transform: scale(0.98);
        }

        .feature-icon {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
        }

        .feature-icon.blue { background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); color: #2563eb; }
        .feature-icon.green { background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); color: #16a34a; }
        .feature-icon.purple { background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%); color: #9333ea; }
        .feature-icon.orange { background: linear-gradient(135deg, #fed7aa 0%, #fdba74 100%); color: #ea580c; }

        .feature-card h3 {
            font-size: 16px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 4px;
        }

        .feature-card p {
            font-size: 12px;
            color: #6b7280;
        }

        /* Quick Access */
        .quick-access-section {
            margin-top: 32px;
        }

        .device-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .device-item {
            background: white;
            border-radius: 16px;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .device-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .device-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .device-icon.yellow { background: #f59e0b; }
        .device-icon.blue { background: #3b82f6; }
        .device-icon.green { background: #10b981; }
        .device-icon.purple { background: #8b5cf6; }

        .device-text h4 {
            font-size: 16px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 2px;
        }

        .device-text p {
            font-size: 12px;
            color: #6b7280;
        }

        .toggle-switch {
            width: 48px;
            height: 28px;
            background: #22c55e;
            border-radius: 14px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.off {
            background: #e5e7eb;
        }

        .toggle-knob {
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 4px;
            right: 4px;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle-switch.off .toggle-knob {
            right: 24px;
        }

        /* Navigation Footer */
        .nav-footer {
            margin-top: 40px;
            padding: 20px;
            text-align: center;
            color: #6b7280;
            font-size: 12px;
        }

        .nav-footer a {
            color: #3b82f6;
            text-decoration: none;
            margin: 0 8px;
        }

        .nav-footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="user-info" onclick="goToAccount()">
                <div class="avatar">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                </div>
                <div class="user-text">
                    <p id="welcomeText">Welcome</p>
                    <h3 id="userName">Guest</h3>
                </div>
            </div>
            
            <div class="header-actions">
                <button class="auth-button" id="authButton" onclick="handleAuthAction()">Sign In</button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="content">
            <!-- Temperature Card -->
            <div class="temp-card">
                <div class="temp-header">
                    <div class="temp-location">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                            <polyline points="9 22 9 12 15 12 15 22"></polyline>
                        </svg>
                        <span>Your home</span>
                    </div>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="rgba(255,255,255,0.8)" stroke-width="2">
                        <path d="M14 14.76V3.5a2.5 2.5 0 0 0-5 0v11.26a4.5 4.5 0 1 0 5 0z"></path>
                    </svg>
                </div>
                <div class="temp-value">
                    <h1 id="temperature">24Â°C</h1>
                    <span class="temp-status">Comfortable</span>
                </div>
                <div class="temp-details">
                    <div>
                        <p>Humidity</p>
                        <p id="humidity">65%</p>
                    </div>
                    <div>
                        <p>Air Quality</p>
                        <p id="airQuality">Good</p>
                    </div>
                    <div>
                        <p>Active Devices</p>
                        <p id="activeDevices">5</p>
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="quick-stats">
                <div class="stat-card">
                    <div class="stat-icon green">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path>
                            <line x1="12" y1="2" x2="12" y2="12"></line>
                        </svg>
                    </div>
                    <h2 id="activeCount">5</h2>
                    <p>Active</p>
                </div>
                <div class="stat-card">
                    <div class="stat-icon blue">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                    </div>
                    <h2 id="scheduleCount">3</h2>
                    <p>Schedules</p>
                </div>
                <div class="stat-card">
                    <div class="stat-icon purple">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                        </svg>
                    </div>
                    <h2 id="energySaved">23%</h2>
                    <p>Saved</p>
                </div>
            </div>

            <!-- Features -->
            <div class="section-header">
                <h2>Features</h2>
            </div>
            <div class="features-grid">
                <a href="/devices" class="feature-card">
                    <div class="feature-icon blue">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M5 12h14M12 5v14" stroke-width="2" stroke-linecap="round"/>
                            <rect x="4" y="4" width="16" height="16" rx="2"/>
                        </svg>
                    </div>
                    <h3>Devices</h3>
                    <p>Control your devices</p>
                </a>
                <a href="/schedules" class="feature-card">
                    <div class="feature-icon green">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                    </div>
                    <h3>Schedules</h3>
                    <p>Manage automation</p>
                </a>
                <a href="/history" class="feature-card">
                    <div class="feature-icon purple">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                    </div>
                    <h3>History</h3>
                    <p>View activity logs</p>
                </a>
                <a href="/analytics" class="feature-card">
                    <div class="feature-icon orange">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="20" x2="12" y2="10"></line>
                            <line x1="18" y1="20" x2="18" y2="4"></line>
                            <line x1="6" y1="20" x2="6" y2="16"></line>
                        </svg>
                    </div>
                    <h3>Analytics</h3>
                    <p>Energy insights</p>
                </a>
            </div>

            <!-- Quick Access -->
            <div class="quick-access-section">
                <div class="section-header">
                    <h2>Quick Access</h2>
                    <a class="see-all" href="/devices">See all</a>
                </div>
                <div class="device-list">
                    <div class="device-item">
                        <div class="device-info">
                            <div class="device-icon yellow">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    <path d="M12 4v1M17.66 6.344l-.828.828M20.005 12.004h-1M17.66 17.664l-.828-.828M12 20.01V19M6.34 17.664l.835-.836M3.995 12.004h1.01M6 6l.835.836"/>
                                </svg>
                            </div>
                            <div class="device-text">
                                <h4>Living Room Light</h4>
                                <p>On â€¢ 45W</p>
                            </div>
                        </div>
                        <div class="toggle-switch" onclick="toggleQuickDevice(this, 'light1')">
                            <div class="toggle-knob"></div>
                        </div>
                    </div>
                    <div class="device-item">
                        <div class="device-info">
                            <div class="device-icon blue">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M17.5 17.5L19 19M21 12a9 9 0 11-9-9m9 9a9 9 0 00-9-9m9 9h-9m9 0a9 9 0 01-9 9"/>
                                </svg>
                            </div>
                            <div class="device-text">
                                <h4>AC Living Room</h4>
                                <p>On â€¢ 24Â°C</p>
                            </div>
                        </div>
                        <div class="toggle-switch" onclick="toggleQuickDevice(this, 'ac1')">
                            <div class="toggle-knob"></div>
                        </div>
                    </div>
                    <div class="device-item">
                        <div class="device-info">
                            <div class="device-icon green">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="2" y="7" width="20" height="15" rx="2" ry="2"/>
                                    <polyline points="17 2 12 7 7 2"/>
                                </svg>
                            </div>
                            <div class="device-text">
                                <h4>Smart TV</h4>
                                <p>Off â€¢ Standby</p>
                            </div>
                        </div>
                        <div class="toggle-switch off" onclick="toggleQuickDevice(this, 'tv1')">
                            <div class="toggle-knob"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation Footer -->
            <div class="nav-footer">
                <p>
                    <a href="/">Home</a> â€¢ 
                    <a href="/devices">Devices</a> â€¢ 
                    <a href="/analytics">Analytics</a> â€¢ 
                    <a href="/account">Account</a> â€¢ 
                    <a href="/login">Login</a>
                </p>
                <p style="margin-top: 8px;">Smart Home Dashboard v1.0 â€¢ Connected to Flask Server</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script>
        // Configuration
        const API_URL = '/api';
        const FLASK_SERVER = window.location.origin;
        
        // Socket.IO connection
        const socket = io(FLASK_SERVER);
        
        // Socket event handlers
        socket.on('connect', () => {
            console.log('âœ… Connected to Flask server via Socket.IO');
        });
        
        socket.on('disconnect', () => {
            console.log('âŒ Disconnected from Flask server');
        });
        
        socket.on('realTimeUpdate', (data) => {
            console.log('ðŸ“ˆ Real-time update received:', data);
            updateRealTimeData(data);
        });
        
        socket.on('deviceUpdated', (data) => {
            console.log('ðŸ”„ Device updated:', data);
            // Update UI if needed
        });
        
        // Load user data from localStorage
        function loadUserData() {
            const token = localStorage.getItem('token');
            const storedUser = localStorage.getItem('userData');
            
            if (token && storedUser) {
                try {
                    const userData = JSON.parse(storedUser);
                    updateUIForLoggedInUser(userData);
                    
                    // Request real-time data
                    socket.emit('requestRealTimeData');
                    
                } catch (error) {
                    console.error('Error loading user data:', error);
                    updateUIForGuest();
                }
            } else {
                updateUIForGuest();
            }
        }
        
        // Update UI for logged in user
        function updateUIForLoggedInUser(user) {
            document.getElementById('userName').textContent = user.name || 'User Name';
            document.getElementById('welcomeText').textContent = 'Welcome back';
            document.getElementById('authButton').textContent = 'Sign Out';
            document.getElementById('authButton').classList.add('logout');
            
            // Apply user settings
            applyUserSettings(user);
        }
        
        // Update UI for guest
        function updateUIForGuest() {
            document.getElementById('userName').textContent = 'Guest';
            document.getElementById('welcomeText').textContent = 'Welcome';
            document.getElementById('authButton').textContent = 'Sign In';
            document.getElementById('authButton').classList.remove('logout');
            
            // Apply default settings
            applyDefaultSettings();
        }
        
        // Apply user settings (dark mode, etc.)
        function applyUserSettings(user) {
            if (user.settings && user.settings.darkMode) {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
        }
        
        // Apply default settings
        function applyDefaultSettings() {
            document.body.classList.remove('dark-mode');
        }
        
        // Update real-time data
        function updateRealTimeData(data) {
            // Update temperature card with random values
            const temp = 20 + Math.floor(Math.random() * 10);
            const humidity = 50 + Math.floor(Math.random() * 30);
            const airQuality = ['Good', 'Fair', 'Excellent'][Math.floor(Math.random() * 3)];
            
            document.getElementById('temperature').textContent = `${temp}Â°C`;
            document.getElementById('humidity').textContent = `${humidity}%`;
            document.getElementById('airQuality').textContent = airQuality;
            document.getElementById('activeDevices').textContent = data.activeDevices || 5;
            document.getElementById('activeCount').textContent = data.activeDevices || 5;
            document.getElementById('energySaved').textContent = `${data.energySaved?.toFixed(0) || 23}%`;
            
            // Update schedule count randomly
            const scheduleCount = 2 + Math.floor(Math.random() * 3);
            document.getElementById('scheduleCount').textContent = scheduleCount;
        }
        
        // Handle auth button click
        function handleAuthAction() {
            const isLoggedIn = localStorage.getItem('token');
            
            if (isLoggedIn) {
                // Sign Out
                if (confirm('Are you sure you want to sign out?')) {
                    localStorage.removeItem('token');
                    localStorage.removeItem('userData');
                    updateUIForGuest();
                    // Optional: Redirect to login page
                    // window.location.href = '/login';
                }
            } else {
                // Sign In - Redirect to login page
                window.location.href = '/login';
            }
        }
        
        // Go to account page
        function goToAccount() {
            const isLoggedIn = localStorage.getItem('token');
            
            if (isLoggedIn) {
                window.location.href = '/account';
            } else {
                window.location.href = '/login';
            }
        }
        
        // Toggle quick access device
        function toggleQuickDevice(element, deviceId) {
            element.classList.toggle('off');
            const isOn = !element.classList.contains('off');
            
            // Update device status text
            const deviceText = element.closest('.device-item').querySelector('.device-text p');
            if (deviceId.includes('light')) {
                deviceText.textContent = isOn ? 'On â€¢ 45W' : 'Off â€¢ 0W';
            } else if (deviceId.includes('ac')) {
                deviceText.textContent = isOn ? 'On â€¢ 24Â°C' : 'Off â€¢ 0W';
            } else if (deviceId.includes('tv')) {
                deviceText.textContent = isOn ? 'On â€¢ 80W' : 'Off â€¢ Standby';
            }
            
            // Send toggle command to backend
            fetch('/toggle_device', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    id: deviceId,
                    state: isOn
                })
            }).then(response => response.json())
              .then(data => {
                  if (data.success) {
                      console.log(`âœ… Device ${deviceId} toggled to ${isOn ? 'ON' : 'OFF'}`);
                  }
              });
        }
        
        // Fetch initial data
        async function fetchInitialData() {
            try {
                // Fetch devices count
                const devicesResponse = await fetch('/api/devices');
                if (devicesResponse.ok) {
                    const devicesData = await devicesResponse.json();
                    if (devicesData.success) {
                        const activeCount = devicesData.data.filter(d => d.status === 'On' || d.status === true).length;
                        document.getElementById('activeCount').textContent = activeCount;
                        document.getElementById('activeDevices').textContent = activeCount;
                    }
                }
            } catch (error) {
                console.error('Error fetching initial data:', error);
            }
        }
        
        // Initialize
        window.addEventListener('load', () => {
            loadUserData();
            fetchInitialData();
            
            // Update data every 30 seconds
            setInterval(fetchInitialData, 30000);
            
            // Initial random values
            updateRealTimeData({
                activeDevices: 5,
                energySaved: 23.5
            });
        });
    </script>
</body>
</html>